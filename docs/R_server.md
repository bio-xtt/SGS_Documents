# Interactive single cell data analysis and visualization
## Rstudio Server
In order to provide a comprehensive visual exploration of single-cell data, the SGS browser integrates the online Rstduio Server. By clicking the ![Rstudio Server](/pictures/4_18.1.png) button, users can enter the analysis environment and perform corresponding single-cell data analysis.
![Rstudio Server](/pictures/4_18.2.png)

## Data formats supports
Currently SGS supports the following mainstream single-cell data analysis formats. Note that all objects must contain at least one expression matrix, grouping information and reduction coordinate file.

+ <b><font color=#3A5FCD>Seurat object</font></b>
+ <b><font color=#3A5FCD>Loom object</font></b>
+ <b><font color=#3A5FCD>Signac object</font></b>
+ <b><font color=#3A5FCD>ArchR object</font></b>

## Export single-cell data 
### Installation sgsload Package
In order to realize the joint exploration of data analysis and visualization, we developed a sgsload R package to directly import the single-cell analysis objects generated by the Rstudio server analysis environment.

```R
# download package
# install from github
devtools::install_github("bio-xtt/sgsload") 

# install from source
install.packages("/home/bio-xtt/Desktop/sgsload_0.1.0.tar.gz", type=source)
```

### Usage of sgsload
#### Getting specices id
Note that before importing single-cell analysis objects directly into the SGS single-cell browser, you need to add a species fasta file and view the id of the species.
```R
# load the package
library(sgsload)

# get the speices id information, the default userid is "user001".
get_species_inform(user_id)
```

#### Example1: Loadding Seurat object into SGS cellbrowser
Loadding a scRNA object created by Seurat into SGS cellbrowser.
```R
# load the example datasets: pbmc_small
data("pbmc_small")

# load the example marker genes: marker.tsv
marker_file <- system.file("extdata/scRNA", "markers.tsv", package = "sgsload")

# use the export function
result_json <- ExportSC(
  object = pbmc_small,
  species_id = "25542c58734641fe98ba9f6b51d17a20",
  track_name = "pbmc_small",
  track_type = "scRNA",
  select_group = c("groups", "RNA_snn_res.0.8", "letter.idents", "cluster"),
  assays = "RNA",
  matrix.slot = list("RNA" = "data"),
  assay.type = list("RNA" = "gene"),
  reductions = c("tsne", "umap"),
  marker.files = list("RNA" = marker_file))
```


#### Example2: Loadding Signac object into SGS cellbrowser
Loadding a scATAC object created by Signac into SGS cellbrowser.
```R
# load the package
library(sgsload)

# get the speices id information
get_species_inform(user_id)

# load the example datasets: pbmc_small
data("atac")

# load the example marker files created by different assay: marker_gene.tsv、marker_motif.tsv、marker_peak.tsv
marker_genes <- system.file("extdata/scATAC", "marker_genes.tsv", package = "sgsload")
marker_motifs <- system.file("extdata/scATAC", "marker_motif.tsv", package = "sgsload")
marker_peaks <- system.file("extdata/scATAC", "marker_peaks.tsv", package = "sgsload")

# create a marker file list and name the list with the correlated assay name
markers <- list(marker_genes, marker_motifs, marker_peaks)
names(markers) <- c("RNA", "chromvar", "peaks")

# if you changed the fragments file path, you should update the fragments file path sorted in the signac object
new.path <- system.file("extdata/scATAC", "fragments.tsv.gz", package = "sgsload")
fragments <- CreateFragmentObject(
  path = new.path,
  cells = colnames(atac),
  validate.fragments = TRUE )
Fragments(atac) <- NULL
Fragments(atac) <- fragments

# use the export function to loadding the scATAC object into SGS cellbrowser
result_json2 <- ExportSC(
  object = atac,
  species_id = "25542c58734641fe98ba9f6b51d17a20",
  track_name = "atac_demo",
  track_type = "scATAC",
  select_group = c("seurat_clusters"),
  assays = c("RNA", "chromvar", "peaks"),
  matrix.slot = list("RNA" = "data", "chromvar" = "data", "peaks" = "data"),
  assay.type = list("RNA" = "gene", "chromvar" = "motif", "peaks" = "peak"),
  reductions = "umap",
  marker.files = markers)
```